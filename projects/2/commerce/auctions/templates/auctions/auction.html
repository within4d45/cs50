{% extends "auctions/layout.html" %}

{% block body %}
    <div class="wrapper auction-wrapper">
        <h1>{{ auction.title }}</h1>
        <div class="auction">

            {% if message %}
            <div class="message">
                {{ message }}
            </div>
            {% elif error %}
            <div class="error">
                {{ error }}
            </div>
            {% endif %}
        
            <div class="auction-image">
                <img src="{{ auction.picture_url }}">
            </div>
        
            <div class="bids">
                {% if auction.active %}
                    <div class="auction-active">
                        <b>Auction is Active</b>
                    </div>

                    {% if bids %}
                        {% if request.user == bids.last.user %}
                            <div class="highest-bidder">You are the highest bidder!</div>
                        {% else %}
                            <div>Current highest bid by: {{ bids.last.user }}</div>
                        {% endif %}
                    {% else %}
                        <div>No bids, yet.</div>
                    {% endif %}

                    <div><b>Current minimum bid: {{ auction.price }}$</b></div>
                    {% if user.is_authenticated %}
                        <div class="place_bid">
                            <form method="post">
                                {% csrf_token %}
                                {{ form_bid }}
                                <input class="form-input button" type="submit" value="Submit">
                            </form>
                        </div>
                    {% endif %}

                {% else %}
                    <div><b>Auction is over. The final price is {{ auction.price }}$</b></div>
                    {% if request.user == bids.last.user %}
                        <div class="winner">You have won the auction. Congratulations!</div>
                    {% endif %}
                {% endif %}
                

            </div>
        
            <div class="comments">
                <h3>Comment section</h3>
                {% for comment in comments %}
                    <div class="comment">
                        <b>{{ comment.user }} commented:</b><br>
                        {{ comment }}

                        {% empty %}
                        <b>No comments, yet. Be the first one!</b>
                    </div>
                {% endfor %}
            
                {% if user.is_authenticated %}
                    <!-- Submit comment -->
                    <div class="submit_comment">
                        <form action="{% url 'submit_comment' auction.pk %}" method="post">
                            {% csrf_token %}
                            {{ form_comment }}
                            <input class="form-input button" type="submit" value="Post Comment">
                        </form>
                    </div>
        

                <div class="other-options">       
                    <!-- Add or remove item from watchlist -->
                    {% if auction.active and user != auction.user %}
                        <div class="watchlist">
                            <form action="{% url 'edit_watchlist' auction.pk %}" method="post">
                                {% csrf_token %}
                                {% if auction_in_watchlist %}
                                    <input type="hidden" name="delete" value="True">
                                    <input class="form-input button" type="submit" value="Delete From Watchlist">
                                {% else %}
                                    <input type="hidden" name="delete" value="False">
                                    <input class="form-input button" type="submit" value="Add to watchlist">
                                {% endif %}
                            </form>
                        </div>
                    {% endif %}
        
        
                    <!-- Close auction -->
                    {% if auction.user == request.user and auction.active %}
                        <div class="close_auction">
                            <form action="{% url 'close_auction' auction.pk %}" method="post">
                                {% csrf_token %}
                                <input class="form-input button" type="submit" value="Close this auction">
                            </form>
                        </div>
                    {% endif %}
                </div>
        
            {% elif not user.is_authenticated %}
                <h3>Log in to access user area</h3>
            {% endif %}
        </div>

    </div>
    

{% endblock %}